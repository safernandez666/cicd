timestamps {

node () {

	stage ('Checkout') {
 	 checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '', url: 'https://github.com/safernandez666/cicd']]]) 
	}
	stage ('Build & Push to DockerHub') {
		sh """ 
        cd app 
        docker build -t app .
        docker tag app:latest safernandez666/app:latest
        docker push safernandez666/app:latest
        docker rmi app safernandez666/app 
		 """		
    }	
	stage ('Deploy Over Kubernetes') {
        kubernetesDeploy(kubeconfigId: 'Okteto',               // REQUIRED
        
                         configs: 'deployment/deployment.yaml', // REQUIRED
                         enableConfigSubstitution: false,
        )
    }	
  }
}